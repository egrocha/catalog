<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">

  <link rel="stylesheet" href="assets/css/collapsible.css">

</head>
<body>
  <div class="vertical-menu">
    <nav class="nav js-nav">
      <header class="nav-header">
        <h1 class="nav-title"><strong>CATÁLOGO</strong></h1>
      </header>

      <div id="region-div">
        <!--
        <button onclick="toggle(1)" type="button" class="region 1">Região 1</button>
        
        <button onclick="subtoggle(1)" type="button" class="maker 1">Produtor 1</button> 
        
        <button onclick="toggleImage(1)" type="button" class="wine 1">Vinho 1</button>
        
        <button onclick="subtoggle(2)" type="button" class="maker 1">Produtor 2</button> 

        <button onclick="toggleImage(2)" type="button" class="wine 2">Vinho 2</button>
        -->
      </div>
    </nav>
  </div>

  <div class="right-content">
    <img src="" id="item-image" class="item-image">
  </div>

  <main class="content js-content"></main>

  <script>
		var data = new Map();

    function populateMap(){
		  data.set(1, {
		  	"name": "Região 1",
		  	"children":{
		  		1: {
		  			"name": "Produtor 1",
		  			"children": {
		  				1: {"name": "Vinho 1", "src": "wine1.jpg"},
		  				2: {"name": "Vinho 2", "src": "wine1.jpg"}
		  			}
		  		},
		  		2: {
		  			"name": "Produtor 2",
		  			"children":{
		  				3: {"name": "Vinho 3", "src": "wine1.jpg"}
		  			}
		  		}
		  	}
		  });

		  data.set(2, {
		  	"name": "Região 2",
		  	"children":{
		  		3: {
		  			"name": "Produtor 3",
		  			"children":{
		  				4: {"name": "Vinho 4", "src": "wine1.jpg"}
		  			}
		  		}
		  	}
		  });
    }

    var tags = ['<button onclick="toggle(1)" type="button" class="region 1">Região 1</button>', 
    '<button onclick="subtoggle(1)" type="button" class="maker 1">Produtor 1</button>', 
    '<button onclick="toggleImage(1)" type="button" class="wine 1">Vinho 1</button>',
    '<button onclick="subtoggle(2)" type="button" class="maker 1">Produtor 2</button>',
    '<button onclick="toggleImage(2)" type="button" class="wine 2">Vinho 2</button>']

    function setTags(){
			var regionDiv = document.getElementById('region-div');
			var tag;
      var children;
			//TODO: GET KEYS FROM MAP INSTEAD OF ITERATING WITH A COUNTER
      //for(var key = 1; key <= data.size; key++){
      for(var [key, value] of data.entries()){
				tag = '<button onclick=\"toggle('+key+')\" id=\''+value.name+'\' type=\"button\" class=\"region '+key+'\">'+value.name+'</button>';
				regionDiv.insertAdjacentHTML( 'beforeend', tag);
        children = value.children;
        for(var [key2, value2] of Object.entries(children)){
          tag = '<button onclick=\"subtoggle('+key+','+key2+')\" id=\''+value2.name+'\' type=\"button\" class=\"maker '+key+'\">'+value2.name+'</button>';
          regionDiv.insertAdjacentHTML( 'beforeend', tag);
          children = value2.children;
          for(var [key3, value3] of Object.entries(children)){
            //the apostrophes around value3.src are necessary to add strings to onclick
            tag = '<button onclick=\"toggleImage(\''+value3.src+'\')\" id=\''+value3.name+'\' type=\"button\" class=\"item '+key+''+key2+'\">'+value3.name+'</button>';
            regionDiv.insertAdjacentHTML( 'beforeend', tag);
          }
        }
				//<button onclick="subtoggle(1)" type="button" class="maker 1">Produtor 1</button>
      }
		}
		
    function setTags2(){
      var regions = document.getElementById('region-div');
      for(var i = 0; i < tags.length; i++){
        regions.insertAdjacentHTML( 'beforeend', tags[i]);
      }
    }

    window.onload = function(){
      populateMap();
      setTags();
    }

    var regionMap = new Map()
    var imageMap = new Map()

    function toggle(id){
      var button;
      for(var [key, value] of data.entries()){
        if (id == key) {
          children = value.children;
          for(var [key2, value2] of Object.entries(children)){
            button = document.getElementById(value2.name)
            if(button.style.display == "block"){
              button.style.display = "none";
            }
            else{
              button.style.display = "block";
            }
            children = value2.children;
            for(var [key3, value3] of Object.entries(children)){
              button = document.getElementById(value3.name)
              if(button.style.display == "block"){
                button.style.display = "none";
              }
            }
          }
        }
      }
    }

    function subtoggle(id, id2){
      var button;
      for(var [key, value] of data.entries()){
        if (id == key) {
          children = value.children;
          for(var [key2, value2] of Object.entries(children)){
            if (id2 == key2) {
              children = value2.children;
              for(var [key3, value3] of Object.entries(children)){
                button = document.getElementById(value3.name)
                if(button.style.display == "block"){
                  button.style.display = "none";
                }
                else{
                  button.style.display = "block";
                }
              }
            }
          }
        }
      }
    }

    function toggleImage(src){
      var image = document.getElementById("item-image");
      image.src = 'assets/images/' + src;
    }
  </script>
</body>
</html>
